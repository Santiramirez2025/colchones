// ============================================================================
// PRISMA SCHEMA - AZUL COLCHONES
// ============================================================================
// âœ… ACTUALIZADO: Agregados campos faltantes usados en la UI
// - badge, discount, gradient, story, image
// ============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================================
// PRODUCT MODEL - âœ… ACTUALIZADO Y COMPLETO
// ============================================================================
model Product {
  id              String            @id @default(cuid())
  name            String
  slug            String            @unique
  subtitle        String
  description     String
  
  // ============================================================================
  // PRICING - Todos los precios en CENTAVOS (multiplicar por 100)
  // ============================================================================
  price           Int                              // Precio base en centavos
  originalPrice   Int?                             // Precio antes de descuento
  compareAtPrice  Int?                             // Precio de comparaciÃ³n
  discount        Int?                             // ðŸ†• Porcentaje de descuento (0-100)
  
  // ============================================================================
  // INVENTORY & STOCK
  // ============================================================================
  stock           Int               @default(0)
  inStock         Boolean           @default(true)
  lowStockAlert   Int               @default(5)
  
  // ============================================================================
  // CATEGORIZATION
  // ============================================================================
  category        String
  subcategory     String?
  tags            String[]
  
  // ============================================================================
  // MEDIA
  // ============================================================================
  images          String[]                         // Array de URLs de imÃ¡genes
  image           String?                          // ðŸ†• Imagen principal (para compatibilidad)
  
  // ============================================================================
  // PRODUCT SPECIFICATIONS
  // ============================================================================
  firmness        String?                          // BLANDO, MEDIO, FIRME, etc.
  firmnessValue   Int               @default(70)   // 0-100 (para ordenamiento)
  height          Int               @default(25)   // Altura en cm
  weight          Int?                             // Peso en kg
  
  // ============================================================================
  // COMMERCIAL TERMS
  // ============================================================================
  warranty        Int               @default(5)    // AÃ±os de garantÃ­a
  trialNights     Int               @default(100)  // Noches de prueba
  
  // ============================================================================
  // FEATURES & DESCRIPTIONS
  // ============================================================================
  features        String[]                         // CaracterÃ­sticas principales
  techFeatures    String[]                         // CaracterÃ­sticas tÃ©cnicas
  highlights      String[]                         // Puntos destacados
  materials       String[]                         // Materiales utilizados
  layers          Json?                            // Estructura de capas (JSON)
  certifications  String[]                         // Certificaciones
  story           String?                          // ðŸ†• Historia/descripciÃ³n del producto
  
  // ============================================================================
  // PRODUCT ATTRIBUTES - BOOLEAN FLAGS
  // ============================================================================
  cooling         Boolean           @default(false) // Sistema de enfriamiento
  isEco           Boolean           @default(false) // Producto ecolÃ³gico
  hypoallergenic  Boolean           @default(true)  // HipoalergÃ©nico
  washable        Boolean           @default(false) // Lavable
  includesBase    Boolean           @default(false) // Incluye base/sommier
  isPremium       Boolean           @default(false) // Producto premium
  antiMite        Boolean           @default(false) // Anti-Ã¡caros
  pillowTop       Boolean           @default(false) // Pillow top
  
  // ============================================================================
  // RATINGS & REVIEWS
  // ============================================================================
  transpirability Int               @default(80)    // 0-100
  satisfaction    Int               @default(95)    // 0-100
  rating          Float             @default(4.8)   // 0-5
  reviewCount     Int               @default(0)
  
  // ============================================================================
  // PRODUCT STATUS FLAGS
  // ============================================================================
  isActive        Boolean           @default(true)
  isFeatured      Boolean           @default(false)
  isBestSeller    Boolean           @default(false)
  isNew           Boolean           @default(false)
  badge           String?                          // ðŸ†• Badge del producto (NUEVO, BESTSELLER, etc)
  
  // ============================================================================
  // LOGISTICS & SHIPPING
  // ============================================================================
  shippingCost    Int               @default(0)     // Costo envÃ­o en centavos
  sku             String?           @unique         // SKU del producto principal
  
  // ============================================================================
  // DISPLAY & DESIGN
  // ============================================================================
  mainColor       String?           @default("#3b82f6") // Color principal (hex)
  gradient        String?                          // ðŸ†• Gradiente para el card
  
  // ============================================================================
  // SEO METADATA
  // ============================================================================
  metaTitle       String?
  metaDescription String?
  metaKeywords    String[]
  
  // ============================================================================
  // TIMESTAMPS
  // ============================================================================
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  // ============================================================================
  // RELATIONS
  // ============================================================================
  cartItems       CartItem[]
  orderItems      OrderItem[]
  reviews         Review[]
  variants        ProductVariant[]

  // ============================================================================
  // INDEXES - OptimizaciÃ³n de queries
  // ============================================================================
  @@index([slug])
  @@index([category])
  @@index([isActive])
  @@index([isBestSeller])
  @@index([price])
  @@index([sku])
  @@index([createdAt])
}

// ============================================================================
// PRODUCT VARIANT MODEL
// ============================================================================
model ProductVariant {
  id            String   @id @default(cuid())
  productId     String
  sku           String   @unique
  size          String                             // 1 plaza, 2 plazas, Queen, King
  dimensions    String                             // 190x80, 190x140, etc.
  width         Int                                // Ancho en cm
  length        Int                                // Largo en cm
  height        Int                                // Alto en cm
  price         Int                                // Precio en centavos
  originalPrice Int?                               // Precio original en centavos
  stock         Int      @default(0)
  inStock       Boolean  @default(true)
  weight        Int?                               // Peso en kg
  isDefault     Boolean  @default(false)           // Variante por defecto
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([sku])
  @@index([size])
}

// ============================================================================
// USER MODEL
// ============================================================================
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  phone         String?
  address       String?
  city          String?
  province      String?
  postalCode    String?
  country       String    @default("Argentina")
  emailVerified DateTime?
  image         String?
  role          String    @default("user")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  cart          Cart?
  orders        Order[]
  reviews       Review[]

  @@index([email])
}

// ============================================================================
// ORDER MODEL
// ============================================================================
model Order {
  id              String      @id @default(cuid())
  orderNumber     String      @unique
  userId          String
  customerName    String
  customerEmail   String
  customerPhone   String?
  shippingAddress Json
  paymentMethod   String
  paymentStatus   String      @default("pending")
  paymentId       String?
  subtotal        Int                              // En centavos
  discount        Int         @default(0)          // En centavos
  shipping        Int         @default(0)          // En centavos
  total           Int                              // En centavos
  status          String      @default("pending")
  trackingNumber  String?
  carrier         String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  deliveredAt     DateTime?
  user            User        @relation(fields: [userId], references: [id])
  items           OrderItem[]

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}

// ============================================================================
// ORDER ITEM MODEL
// ============================================================================
model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Int                                    // Precio en centavos
  size      String?
  color     String?
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

// ============================================================================
// CART MODEL
// ============================================================================
model Cart {
  id        String     @id @default(cuid())
  userId    String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     CartItem[]

  @@index([userId])
}

// ============================================================================
// CART ITEM MODEL
// ============================================================================
model CartItem {
  id        String   @id @default(cuid())
  cartId    String
  productId String
  quantity  Int      @default(1)
  size      String?
  color     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id])

  @@unique([cartId, productId, size, color])
  @@index([cartId])
  @@index([productId])
}

// ============================================================================
// REVIEW MODEL
// ============================================================================
model Review {
  id        String   @id @default(cuid())
  productId String
  userId    String
  rating    Int                                    // 1-5
  title     String?
  comment   String
  verified  Boolean  @default(false)              // Compra verificada
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId])
  @@index([userId])
  @@index([rating])
}

// ============================================================================
// COUPON MODEL
// ============================================================================
model Coupon {
  id          String    @id @default(cuid())
  code        String    @unique
  description String?
  type        String                               // percentage, fixed
  value       Int                                  // Porcentaje o monto en centavos
  minPurchase Int?                                 // Compra mÃ­nima en centavos
  maxUses     Int?
  usedCount   Int       @default(0)
  isActive    Boolean   @default(true)
  startsAt    DateTime?
  expiresAt   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([code])
  @@index([isActive])
}

// ============================================================================
// NEWSLETTER MODEL
// ============================================================================
model Newsletter {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  @@index([email])
}